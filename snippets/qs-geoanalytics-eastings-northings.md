# Convert Eastings and Northings to Lat/ Long for QS maps

For QSECM with GeoAnalytics connector

```
// Convert eastings and northings to lat long for Qlik Sense mapping

// Load source where values correct
Source:
LOAD
    %KeyLocation,
    Easting,
    Northing,
    RowNo()		AS RowNo
FROM [lib://AttachedFiles/Dim_Location.qvd]
(qvd)
WHERE Easting>1000 AND Northing>1000 AND IsNum(Easting) AND IsNum(Northing);



LIB CONNECT TO '<GA server>';

/* Generated by GeoAnalytics for operation Load ---------------------- */
[_inlineMap_]:
mapping LOAD * inline [
_char_, _utf_
"'", '\u0027'
'"', '\u0022'
"[", '\u005b'
"/", '\u002f'
"*", '\u002a'
";", '\u003b'
"}", '\u007d'
"{", '\u007b'
"`", '\u0060'
"Â´", '\u00b4'
"	", '\u0009'
];

IF FieldNumber('%KeyLocation', 'Source') = 0 THEN
	call InvalidInlineData('The field %KeyLocation in Source is not available');
END IF
IF FieldNumber('Easting', 'Source') = 0 THEN
	call InvalidInlineData('The field Easting in Source is not available');
END IF
IF FieldNumber('Northing', 'Source') = 0 THEN
	call InvalidInlineData('The field Northing in Source is not available');
END IF
Let [TranslatedInlineTable] = '%KeyLocation' & Chr(9) & 'Easting' & Chr(9) & 'Northing';
Let numRows = NoOfRows('Source');
Let chunkSize = 1000;
Let chunks = numRows/chunkSize;
For n = 0 to chunks
	Let chunkText = '';
	Let chunk = n*chunkSize;
	For i = 0 To chunkSize-1
		Let row = '';
		Let rowNr = chunk+i;
		Exit for when rowNr >= numRows;
		For Each f In '%KeyLocation', 'Easting', 'Northing'
			row = row & Chr(9) & MapSubString('_inlineMap_', Peek('$(f)', $(rowNr), 'Source'));
		Next
		chunkText = chunkText & Chr(10) & Mid('$(row)', 2);
	Next
	[TranslatedInlineTable] = [TranslatedInlineTable] & chunkText;
Next
chunkText=''


[Translated]:
SQL SELECT [%KeyLocation], [Translated_Geometry] FROM Load(dataset='Translated')
DATASOURCE Translated INLINE tableName='Source', tableFields='%KeyLocation,Easting,Northing', geometryType='POINTLATLON', loadDistinct='NO', suffix='', crs='EPSG:27700' {$(TranslatedInlineTable)}
;
tag field [%KeyLocation] with '$primarykey';
tag field [Translated_Geometry] with '$geopoint';
tag field [%KeyLocation] with '$geoname';
tag field [Translated_Geometry] with '$relates_%KeyLocation';
tag field [%KeyLocation] with '$relates_Translated_Geometry';

[TranslatedInlineTable] = '';

/* End GeoAnalytics operation Load ----------------------------------- */
```
